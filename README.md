# Документация проекта ФитоДомик

## Структура папки python_application_2

Папка `python_application_2` содержит следующие файлы:

- **FitoDomik.py** (144 КБ): Основной Python-скрипт с интерфейсом системы "Умная теплица"
- **FitoDomik.exe** (93 МБ): Скомпилированная версия программы FitoDomik для Windows
- **67fb70c98d5b2.ico** (54 КБ): Иконка приложения
- **temp_humidity_light_2** (папка): Содержит скетч Arduino для микроконтроллера

### Папка temp_humidity_light_2

- **temp_humidity_light_2.ino** (8.4 КБ): Скетч Arduino для управления датчиками и устройствами теплицы

## Описание FitoDomik.py

`FitoDomik.py` - основной файл приложения "ФитоДомик", представляющий собой систему мониторинга и управления умной теплицей с графическим интерфейсом на PyQt6.

### Основные возможности:

1. **Мониторинг параметров окружения растений:**
   - Температура воздуха
   - Влажность воздуха
   - Влажность почвы
   - Уровень освещённости
   - Уровень CO₂
   - Атмосферное давление

2. **Управление устройствами теплицы:**
   - Включение/выключение лампы
   - Открытие/закрытие штор
   - Управление насосом для полива
   - Управление вентилятором

3. **Мониторинг состояния растений:**
   - Фотографирование растений через подключенную камеру
   - Компьютерный анализ изображений для определения состояния растений
   - Обнаружение возможных болезней и вредителей
   - Анализ цветовых характеристик листьев

4. **Удалённый мониторинг:**
   - Загрузка данных на веб-сервер
   - Интеграция с онлайн-платформой через API
   - Возможность просмотра истории параметров

5. **Настройка автоматического функционирования:**
   - Установка пороговых значений для параметров
   - Автоматическое управление устройствами при выходе параметров за пределы допустимых
   - Планирование фотографирования растений по расписанию

### Основные компоненты интерфейса:

- **Вкладка "Мониторинг"**: Отображает текущие показания датчиков и результаты последнего анализа растения
- **Вкладка "Управление"**: Ручное управление устройствами (лампа, шторы, насос, вентилятор)
- **Вкладка "Журнал"**: Отображение лога работы системы с возможностью фильтрации и сохранения
- **Вкладка "Пороги и настройки"**: Настройка пороговых значений для автоматизации
- **Вкладка "Настройки"**: Конфигурация API-токена, соединения с Arduino, камеры и интервалов обновления

### Основные классы и их функциональность:

1. **SensorMonitoringThread**: Поток для сбора данных с датчиков Arduino
2. **DevicesControlThread**: Поток для управления устройствами
3. **PlantPhotoThread**: Поток для фотографирования и анализа растений
4. **CustomNotification**: Стилизованные уведомления в интерфейсе
5. **FarmControlApp**: Основной класс приложения, управляющий интерфейсом и логикой работы

### Ключевые функции:

- **start_system()**: Запуск системы мониторинга и управления
- **analyze_plant()**: Фотографирование и анализ растения
- **control_led()**, **control_curtains()**, **control_pump()**, **control_fan()**: Управление устройствами
- **update_thresholds()**: Обновление пороговых значений
- **save_settings()**: Сохранение настроек приложения
- **send_command()**: Отправка команды на Arduino
- **update_sensor_values()**: Обработка данных, полученных от Arduino
- **save_to_server()**: Отправка данных на сервер

## Описание temp_humidity_light_2.ino

Файл `temp_humidity_light_2.ino` содержит программу для микроконтроллера Arduino, которая обеспечивает взаимодействие с датчиками и исполнительными устройствами умной теплицы.

### Основные возможности:

1. **Работа с датчиками:**
   - Датчик температуры и влажности воздуха (DHT)
   - Датчик влажности почвы
   - Датчик освещенности
   - Датчик CO₂ и атмосферного давления

2. **Управление устройствами:**
   - Реле для включения/выключения лампы
   - Реле для управления сервоприводом штор (открытие/закрытие)
   - Реле для насоса системы полива
   - Реле для управления вентилятором

3. **Взаимодействие с компьютером:**
   - Получение команд через последовательный порт
   - Отправка данных о показаниях датчиков
   - Подтверждение выполнения команд

### Основной цикл работы:

1. Считывание показаний с датчиков
2. Отправка данных в последовательный порт в формате, понятном для Python-приложения
3. Проверка наличия команд от компьютера
4. Обработка полученных команд и управление соответствующими устройствами
5. Подтверждение выполнения команды в обратном канале связи

### Формат команд:

Arduino принимает команды в виде строки в формате:
```
УСТРОЙСТВО:СОСТОЯНИЕ
```

где:
- `УСТРОЙСТВО` может быть: LED (лампа), CURTAINS (шторы), RELAY3 (насос), RELAY4 (вентилятор)
- `СОСТОЯНИЕ`: 1 (включить) или 0 (выключить)

Примеры команд:
- `LED:1` - включить лампу
- `CURTAINS:0` - открыть шторы
- `RELAY3:1` - включить насос
- `RELAY4:0` - выключить вентилятор

## Общая архитектура системы

Проект "ФитоДомик" представляет собой комплексную систему, состоящую из:

1. **Аппаратной части:**
   - Микроконтроллер Arduino с подключенными датчиками и реле
   - Камера для фотографирования растений
   - Исполнительные устройства (лампа, механизм шторы, насос, вентилятор)

2. **Программной части:**
   - Скетч Arduino для управления датчиками и устройствами
   - Python-приложение с графическим интерфейсом для управления и мониторинга
   - Система компьютерного зрения для анализа состояния растений

3. **Серверной части:**
   - Веб-сервер для хранения истории показаний и фотографий
   - API для взаимодействия приложения с сервером

### Принцип работы:

1. Arduino считывает данные с датчиков и отправляет их на компьютер
2. Python-приложение обрабатывает полученные данные и:
   - Отображает их в удобном интерфейсе
   - Сохраняет историю в базу данных
   - Отправляет данные на веб-сервер
   - Принимает решения о включении/выключении устройств на основе заданных порогов
3. По расписанию или по команде пользователя выполняется фотографирование растения
4. Изображение анализируется для определения состояния растения
5. Пользователь может удалённо мониторить состояние теплицы и управлять устройствами

## Начало работы с системой

1. Убедитесь, что Arduino подключен к компьютеру и загружен скетч `temp_humidity_light_2.ino`
2. Запустите приложение `FitoDomik.py` (или `FitoDomik.exe` для Windows)
3. Во вкладке "Настройки" укажите:
   - API-токен (получите на сайте farm429.online/get_token.php)
   - COM-порт, к которому подключен Arduino
   - Индекс камеры (обычно 0 для встроенной камеры)
   - Интервалы обновления данных и фотографирования
4. Нажмите "ЗАПУСТИТЬ СИСТЕМУ" на вкладке "Мониторинг"

После запуска система будет автоматически считывать показания датчиков, управлять устройствами и делать фотографии растений по расписанию.

## Устранение неполадок

1. **Проблемы с подключением к Arduino:**
   - Убедитесь, что выбран правильный COM-порт
   - Проверьте подключение USB-кабеля
   - Перезагрузите Arduino и перезапустите приложение

2. **Проблемы с камерой:**
   - Проверьте, что камера подключена и работает
   - Попробуйте изменить индекс камеры в настройках
   - Убедитесь, что другие приложения не используют камеру

3. **Проблемы с отправкой данных на сервер:**
   - Проверьте правильность API-токена
   - Убедитесь, что компьютер подключен к интернету
   - Проверьте логи в журнале приложения для диагностики ошибок 
